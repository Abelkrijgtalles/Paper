From 3aeeaf31b7a7f888f54e47826e8ec0ddbe65c4bf Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 14:37:42 +0100
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/network/protocol/game/ServerboundContainerClickPacket.java b/net/minecraft/network/protocol/game/ServerboundContainerClickPacket.java
index 406a7027dbb8de208b1ebb5160be28df75045f72..109046f148410ec7f5c23a8a524cb6c2f73d7d9b 100644
--- a/net/minecraft/network/protocol/game/ServerboundContainerClickPacket.java
+++ b/net/minecraft/network/protocol/game/ServerboundContainerClickPacket.java
@@ -17,7 +17,7 @@ public class ServerboundContainerClickPacket implements Packet<ServerGamePacketL
     );
     private static final int MAX_SLOT_COUNT = 128;
     private static final StreamCodec<RegistryFriendlyByteBuf, Int2ObjectMap<ItemStack>> SLOTS_STREAM_CODEC = ByteBufCodecs.map(
-        Int2ObjectOpenHashMap::new, ByteBufCodecs.SHORT.map(Short::intValue, Integer::shortValue), ItemStack.OPTIONAL_STREAM_CODEC, 128
+        Int2ObjectOpenHashMap::new, ByteBufCodecs.SHORT.map(Short::intValue, Integer::shortValue), ItemStack.OPTIONAL_STREAM_CODEC.apply(ByteBufCodecs::trackDepth), 128 // Paper - Track codec depth
     );
     private final int containerId;
     private final int stateId;
@@ -46,7 +46,7 @@ public class ServerboundContainerClickPacket implements Packet<ServerGamePacketL
         this.buttonNum = buffer.readByte();
         this.clickType = buffer.readEnum(ClickType.class);
         this.changedSlots = Int2ObjectMaps.unmodifiable(SLOTS_STREAM_CODEC.decode(buffer));
-        this.carriedItem = ItemStack.OPTIONAL_STREAM_CODEC.decode(buffer);
+        this.carriedItem = ItemStack.OPTIONAL_STREAM_CODEC.apply(ByteBufCodecs::trackDepth).decode(buffer); // Paper - Track codec depth
     }
 
     private void write(RegistryFriendlyByteBuf buffer) {
