From 3aeeaf31b7a7f888f54e47826e8ec0ddbe65c4bf Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 14:37:42 +0100
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/effect/MobEffectInstance.java b/net/minecraft/world/effect/MobEffectInstance.java
index bae1ac10c9a6bcbad781e2a96bff61dcb3755413..eb3b55da18aa17e494ebf2449eda3b051ede5d76 100644
--- a/net/minecraft/world/effect/MobEffectInstance.java
+++ b/net/minecraft/world/effect/MobEffectInstance.java
@@ -216,6 +216,7 @@ public class MobEffectInstance implements Comparable<MobEffectInstance> {
             int i = this.isInfiniteDuration() ? entity.tickCount : this.duration;
             if (entity.level() instanceof ServerLevel serverLevel
                 && this.effect.value().shouldApplyEffectTickThisTick(i, this.amplifier)
+                && new io.papermc.paper.event.entity.EntityEffectTickEvent(entity.getBukkitLivingEntity(), org.bukkit.craftbukkit.potion.CraftPotionEffectType.minecraftHolderToBukkit(this.effect), this.amplifier).callEvent() // Paper - Add EntityEffectTickEvent
                 && !this.effect.value().applyEffectTick(serverLevel, entity, this.amplifier)) {
                 entity.removeEffect(this.effect);
             }
@@ -408,7 +409,7 @@ public class MobEffectInstance implements Comparable<MobEffectInstance> {
                     .apply(instance, MobEffectInstance.Details::create)
             )
         );
-        public static final StreamCodec<ByteBuf, MobEffectInstance.Details> STREAM_CODEC = StreamCodec.recursive(
+        public static final StreamCodec<net.minecraft.network.FriendlyByteBuf, MobEffectInstance.Details> STREAM_CODEC = StreamCodec.recursive( // Paper - Track codec depth
             codec -> StreamCodec.composite(
                 ByteBufCodecs.VAR_INT,
                 MobEffectInstance.Details::amplifier,
@@ -420,7 +421,7 @@ public class MobEffectInstance implements Comparable<MobEffectInstance> {
                 MobEffectInstance.Details::showParticles,
                 ByteBufCodecs.BOOL,
                 MobEffectInstance.Details::showIcon,
-                codec.apply(ByteBufCodecs::optional),
+                codec.apply(ByteBufCodecs::increaseDepth).apply(ByteBufCodecs::optional), // Paper - Track codec depth
                 MobEffectInstance.Details::hiddenEffect,
                 MobEffectInstance.Details::new
             )
