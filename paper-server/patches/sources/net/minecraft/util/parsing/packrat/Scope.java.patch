--- a/net/minecraft/util/parsing/packrat/Scope.java
+++ b/net/minecraft/util/parsing/packrat/Scope.java
@@ -79,6 +_,7 @@
     public void pushFrame() {
         this.ensureCapacity(1);
         this.setupNewFrame();
+        if (this.topEntryKeyIndex > 512 * 2) throw new IllegalStateException("Too deep"); // Paper - limit max scope depth
 
         assert this.validateStructure();
     }
