From 3aeeaf31b7a7f888f54e47826e8ec0ddbe65c4bf Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 14:37:42 +0100
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/entity/ai/behavior/ResetProfession.java b/net/minecraft/world/entity/ai/behavior/ResetProfession.java
index 146af7eddabb7abb47921784f88c2180ce13a613..0fba9d252fb11715bdbda0576f519f947f2a7d4e 100644
--- a/net/minecraft/world/entity/ai/behavior/ResetProfession.java
+++ b/net/minecraft/world/entity/ai/behavior/ResetProfession.java
@@ -18,7 +18,14 @@ public class ResetProfession {
                             && villagerData.getProfession() != VillagerProfession.NITWIT
                             && villager.getVillagerXp() == 0
                             && villagerData.getLevel() <= 1) {
-                            villager.setVillagerData(villager.getVillagerData().setProfession(VillagerProfession.NONE));
+                            // CraftBukkit start
+                            org.bukkit.event.entity.VillagerCareerChangeEvent event = org.bukkit.craftbukkit.event.CraftEventFactory.callVillagerCareerChangeEvent(villager, org.bukkit.craftbukkit.entity.CraftVillager.CraftProfession.minecraftToBukkit(VillagerProfession.NONE), org.bukkit.event.entity.VillagerCareerChangeEvent.ChangeReason.LOSING_JOB);
+                            if (event.isCancelled()) {
+                                return false;
+                            }
+
+                            villager.setVillagerData(villager.getVillagerData().setProfession(org.bukkit.craftbukkit.entity.CraftVillager.CraftProfession.bukkitToMinecraft(event.getProfession())));
+                            // CraftBukkit end
                             villager.refreshBrain(level);
                             return true;
                         } else {
